<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fête du Seeee 2025 im Strandbad Tegelsee | Kulturinsel Moabit</title>
  <meta name="description" content="Erlebe das ehrenamtliche Musikfestival Fête du Seeee am 29.–30.08.2025 im Strandbad Tegelsee. Jetzt Programm entdecken!" />
  <link rel="canonical" href="https://kulturinselmoabit.org/fete/" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet" />
  <!-- „gestempelte“ Schrift nur fürs Line-up -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Dirt&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="/styles.css?v=simple-banner" />
</head>
<body class="fete-page">

  <!-- HEADER -->
  <header id="site-header">
    <div class="container header-inner">
      <div class="logo">
        <img src="/logo.svg" alt="Logo Kulturinsel Moabit" />
      </div>
      <nav class="site-nav">
        <button class="menu-toggle" aria-label="Menü öffnen / schließen">
          <span></span><span></span><span></span>
        </button>
        <ul>
          <li><a href="/">Startseite</a></li>
          <li><a href="/fete/" class="active">Fête du Seeee</a></li>
          <li><a href="/jam/">Jamsession</a></li>
          <li><a href="/mitmachen/">Mitmachen</a></li>
          <li><a href="/uber-uns/">Über uns</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <section class="container page-inner page-inner--wide">
      <div class="page-text">

        <!-- Banner (einfaches IMG) -->
        <section class="fete-banner" aria-label="Festival-Banner">
          <img class="fete-banner-img" src="fete-banner.svg" alt="Fête du Seeee – Banner" />
        </section>

        <!-- Meta-Zeile -->
        <div class="fete-meta">
          <span>Strandbad Tegelsee</span>
          <span class="sep">•</span>
          <span>29. &amp; 30. August 2025</span>
        </div>

        <!-- Intro-Text (clean) -->
        <section class="info-block">
          <p>
            Dieses Jahr wird unsere Fête du Seeee noch bunter und größer:
            Wir feiern an zwei Tagen auf gleich <strong>zwei Bühnen</strong> im wunderschönen
            Strandbad Tegelsee! Freut euch auf ein vielseitiges Programm aus Musik, Theater und Kunst,
            das von ehrenamtlichen Künstler*innen für euch gestaltet wird.
          </p>
          <p>
            Genießt tagsüber Kultur-Highlights und bunte Aktionen für Groß und Klein direkt am Wasser,
            und lasst euch abends von mitreißenden Konzerten und Performances auf beiden Bühnen mitreißen.
            Bei den unterschiedlichsten Genres ist für jeden Geschmack etwas dabei!
          </p>
        </section>

        <!-- SLIDESHOW (nimmt 1–9.jpg/.mp4 aus demselben Ordner) -->
        <section class="fete-hero">
          <div class="fete-slider" id="feteSlider" aria-label="Festival-Impressionen">
            <button class="fete-control prev" aria-label="Vorheriges">‹</button>
            <button class="fete-control next" aria-label="Nächstes">›</button>
            <div class="fete-dots" role="tablist" aria-label="Slideshow-Navigation"></div>
          </div>
          <noscript>
            <img src="1.jpg" alt="Festivalbild 1" style="width:100%;height:auto;border-radius:8px;display:block;margin-top:.5rem;">
          </noscript>
        </section>

        <!-- ===== LINE-UP (dynamisch aus CSV, ohne CSS-Änderungen) ===== -->
        <section class="lineup" id="lineup">
          <div class="lineup-wrap">
            <div class="lineup-heading">Line-Up</div>
            <!-- Dynamischer Inhalt hier hinein -->
            <div class="lu-root" aria-live="polite"></div>
          </div>

          <!-- Zugängliches Modal (Standard-Dialog, keine Styles hinzugefügt) -->
          <dialog id="luModal" aria-label="Details">
            <button type="button" class="lu-close" aria-label="Schließen">×</button>
            <div class="lu-media-wrap" hidden>
              <img class="lu-media" alt="" loading="lazy" />
            </div>
            <h3 class="lu-title"></h3>
            <div class="lu-time"></div>
            <div class="lu-desc"></div>
          </dialog>
        </section>
        <!-- ===== /LINE-UP ===== -->

        <!-- Eintritt -->
        <section class="entry">
          <h2 class="section-title">Eintritt</h2>
          <p><strong>nur Strandbadeintritt:</strong></p>
          <ul>
            <li>Erwachsene: 6 €</li>
            <li>Ermäßigt: 4 €</li>
            <li>Ab 18 Uhr: 2,50 €</li>
          </ul>
          <p>
            Kommt vorbei, bringt eure Freund*innen mit und lasst uns gemeinsam am
            Tegeler See feiern – wir freuen uns auf euch!
          </p>
        </section>

      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer id="site-footer">
    <div class="container footer-inner">
      <p>
        <a href="/impressum.html">Impressum</a> |
        <a href="/kontakt.html">Kontakt</a> |
        <a href="/datenschutz.html">Datenschutz</a>
      </p>
      <p>© 2025 Kulturinsel Moabit – alle Rechte vorbehalten</p>
    </div>
  </footer>

  <!-- JS: Burger-Menü -->
  <script>
    const btn = document.querySelector('.menu-toggle');
    const nav = document.querySelector('.site-nav ul');
    if (btn && nav) {
      btn.addEventListener('click', () => {
        nav.classList.toggle('open');
        btn.classList.toggle('open');
      });
    }
  </script>

  <!-- JS: Slideshow-Loader (robust, JPG/MP4 1–9) -->
  <script>
  (function(){
    const slider = document.getElementById('feteSlider');
    if (!slider) return;

    let prevBtn = slider.querySelector('.fete-control.prev');
    let nextBtn = slider.querySelector('.fete-control.next');
    let dotsWrap = slider.querySelector('.fete-dots');

    function mk(tag, cls, txt){
      const el = document.createElement(tag);
      if (cls) el.className = cls;
      if (txt != null) el.textContent = txt;
      return el;
    }
    if (!prevBtn){ prevBtn = mk('button','fete-control prev','‹'); prevBtn.setAttribute('aria-label','Vorheriges'); slider.appendChild(prevBtn); }
    if (!nextBtn){ nextBtn = mk('button','fete-control next','›'); nextBtn.setAttribute('aria-label','Nächstes'); slider.appendChild(nextBtn); }
    if (!dotsWrap){ dotsWrap = mk('div','fete-dots'); dotsWrap.setAttribute('role','tablist'); dotsWrap.setAttribute('aria-label','Slideshow-Navigation'); slider.appendChild(dotsWrap); }

    function folderPath(){
      const p = location.pathname;
      if (p.endsWith('/')) return p;
      if (/\/index\.html?$/i.test(p)) return p.replace(/index\.html?$/i,'');
      if (p.includes('.')) return p.replace(/[^/]+$/, '');
      return p + '/';
    }
    const base = location.origin + folderPath();

    function loadImage(url){
      return new Promise(resolve=>{
        const img = new Image();
        img.onload  = ()=>resolve({ok:true, node:img});
        img.onerror = ()=>resolve({ok:false});
        img.decoding = 'async';
        img.src = url;
      });
    }
    function loadVideo(url){
      return new Promise(resolve=>{
        const v = document.createElement('video');
        v.preload='metadata'; v.muted=true; v.playsInline=true; v.setAttribute('playsinline',''); v.loop=true;
        const ok=()=>{ cleanup(); resolve({ok:true, node:v}); };
        const err=()=>{ cleanup(); resolve({ok:false}); };
        function cleanup(){ v.removeEventListener('loadedmetadata', ok); v.removeEventListener('error', err); }
        v.addEventListener('loadedmetadata', ok);
        v.addEventListener('error', err);
        v.src = url;
      });
    }
    async function probe(n){
      const jpg = base + `${n}.jpg`;
      let r = await loadImage(jpg);
      if (r.ok){ r.node.alt = `Festivalbild ${n}`; return {idx:n, node:r.node}; }
      const mp4 = base + `${n}.mp4`;
      r = await loadVideo(mp4);
      if (r.ok){ return {idx:n, node:r.node}; }
      return null;
    }

    (async function init(){
      const results = await Promise.all(Array.from({length: 9}, (_,i)=>probe(i+1)));
      const items = results.filter(Boolean).sort((a,b)=>a.idx - b.idx);
      if (!items.length) return;

      const slides = [], dots = [];
      function addSlide(node, i){
        const wrap = mk('div','fete-slide');
        wrap.setAttribute('data-index', i);
        wrap.setAttribute('aria-hidden','true');
        wrap.appendChild(node);
        slider.insertBefore(wrap, dotsWrap);

      const dot = mk('button','fete-dot');
        dot.type='button';
        dot.setAttribute('aria-label','Slide '+(i+1));
        dotsWrap.appendChild(dot);

        slides.push(wrap); dots.push(dot);
      }
      items.forEach((it,i)=>addSlide(it.node, i));

      slider.appendChild(prevBtn);
      slider.appendChild(nextBtn);
      slider.appendChild(dotsWrap);

      let current = 0;
      function show(i){
        current = (i + slides.length) % slides.length;
        slides.forEach((el, idx)=>{
          const active = idx === current;
          el.classList.toggle('active', active);
          el.setAttribute('aria-hidden', active ? 'false' : 'true');
          const v = el.querySelector('video');
          if (v){ active ? v.play().catch(()=>{}) : v.pause(); }
        });
        dots.forEach((d, idx)=>d.classList.toggle('active', idx === current));
      }

      prevBtn.addEventListener('click', ()=>show(current - 1));
      nextBtn.addEventListener('click', ()=>show(current + 1));

      slider.setAttribute('tabindex','0');
      slider.addEventListener('keydown', e=>{
        if (e.key === 'ArrowLeft')  show(current - 1);
        if (e.key === 'ArrowRight') show(current + 1);
      });

      let sx=null;
      slider.addEventListener('touchstart', e=>{ sx = e.touches[0].clientX; }, {passive:true});
      slider.addEventListener('touchend',   e=>{
        if (sx==null) return;
        const dx = e.changedTouches[0].clientX - sx;
        if (Math.abs(dx) > 40) (dx < 0 ? show(current + 1) : show(current - 1));
        sx = null;
      });

      show(0);

      // Autoplay (5s), pausiert bei Interaktion/Tab-Wechsel
      let timer = null, hover = false;
      function next(){ nextBtn.click(); }
      function start(){ if (!timer && slides.length > 1) timer = setInterval(()=>{ if (!hover && !document.hidden) next(); }, 5000); }
      function stop(){ clearInterval(timer); timer = null; }
      slider.addEventListener('mouseenter',()=>hover=true);
      slider.addEventListener('mouseleave',()=>hover=false);
      slider.addEventListener('touchstart', ()=>hover=true, {passive:true});
      slider.addEventListener('touchend',   ()=>hover=false, {passive:true});
      document.addEventListener('visibilitychange', ()=>{ document.hidden ? stop() : start(); });
      start();
    })();
  })();
  </script>

  <!-- PapaParse für CSV -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- CSV → Line-up Renderer (ohne CSS-Änderungen) -->
  <script>
  (function(){
    // Konfiguration
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkYgQhBk53GOGABV_qzv3ZqjgSfR61ZH9_fX-uejRTUOQ4EtAgARUXXIayqaPKWRr5hBRMCH219-_j/pub?output=csv";
    const IMG_BASE = ""; // optional, z.B. "/assets/lineup/"

    const wrap = document.querySelector('.lineup .lineup-wrap');
    const root = document.querySelector('.lineup .lu-root');
    if (!wrap || !root) return;

    // evtl. statische Einträge entfernen (wir rendern komplett neu)
    Array.from(wrap.querySelectorAll('.line')).forEach(n => n.remove());

    // Helpers
    const norm = s => (s ?? "").toString().trim();
    const lc = s => norm(s).toLowerCase();
    function pick(obj, keys){
      const map = {};
      Object.keys(obj || {}).forEach(k => map[lc(k)] = obj[k]);
      for (const key of keys){
        const kk = lc(key);
        if (map.hasOwnProperty(kk)) return norm(map[kk]);
      }
      const want = keys.map(lc);
      for (const k in map){
        if (want.some(w => k.includes(w))) return norm(map[k]);
      }
      return "";
    }
    function timeToMinutes(str){
      const s = lc(str).replace(/[^\d:.,-]/g, "").replace(",", ":").replace(".", ":");
      const m = s.match(/(\d{1,2})[:.]?(\d{2})?/);
      if (!m) return Number.POSITIVE_INFINITY;
      const h = parseInt(m[1],10);
      const mm = m[2] ? parseInt(m[2],10) : 0;
      if (isNaN(h) || isNaN(mm)) return Number.POSITIVE_INFINITY;
      return h*60 + mm;
    }
    function fmtTime(start, end){
      const s = norm(start), e = norm(end);
      if (!s && !e) return "";
      if (s && !e) return s;
      if (!s && e) return e;
      return s + "–" + e;
    }
    function normalizeDayLabel(dayRaw){
      const d = lc(dayRaw);
      if (!d) return norm(dayRaw);
      if (["fr","fr.","fri","fre","freitag","friday"].includes(d)) return "FR. 29. AUGUST";
      if (["sa","sa.","sam","samstag","sat","saturday"].includes(d)) return "SA. 30. AUGUST";
      return norm(dayRaw);
    }
    function imgURL(v){
      const u = norm(v);
      if (!u) return "";
      if (/^https?:\/\//i.test(u) || u.startsWith("/") || u.startsWith("data:")) return u;
      const base = norm(IMG_BASE);
      if (!base) return u;
      return (base.endsWith("/") ? base : base + "/") + u.replace(/^\/+/, "");
    }

    // Modal-Elemente (Standarddialog, keine Styles)
    const dlg = document.getElementById('luModal');
    const dlgClose = dlg?.querySelector('.lu-close');
    const dlgImgWrap = dlg?.querySelector('.lu-media-wrap');
    const dlgImg = dlg?.querySelector('.lu-media');
    const dlgTitle = dlg?.querySelector('.lu-title');
    const dlgTime = dlg?.querySelector('.lu-time');
    const dlgDesc = dlg?.querySelector('.lu-desc');

    function openModal({title, time, desc, image}){
      if (!dlg) return;
      dlgTitle.textContent = title || "";
      dlgTime.textContent = time || "";
      if (image){
        dlgImgWrap.hidden = false;
        dlgImg.src = image;
        dlgImg.alt = title || "";
      } else {
        dlgImg.src = "";
        dlgImg.alt = "";
        dlgImgWrap.hidden = true;
      }
      dlgDesc.textContent = "";
      if (desc){
        const parts = desc.split(/\r?\n/);
        parts.forEach((line, i) => {
          if (i) dlgDesc.appendChild(document.createElement('br'));
          dlgDesc.appendChild(document.createTextNode(line));
        });
      }
      try { dlg.showModal(); } catch(e){ dlg.setAttribute('open',''); }
      setTimeout(()=>{ dlgClose?.focus(); }, 0);
    }
    function closeModal(){ dlg?.close?.(); dlg?.removeAttribute('open'); }
    dlgClose?.addEventListener('click', closeModal);
    dlg?.addEventListener('cancel', (e)=>{ e.preventDefault(); closeModal(); });
    dlg?.addEventListener('click', (e)=>{
      const r = dlg.getBoundingClientRect();
      if (e.clientX < r.left || e.clientX > r.right || e.clientY < r.top || e.clientY > r.bottom){
        closeModal();
      }
    });

    // Render eines Tagesblocks
    function renderDayBlock(dayLabel, acts){
      const day = document.createElement('div');
      day.className = 'line';

      const tag = document.createElement('div');
      tag.className = 'lineup-daytag';
      tag.textContent = dayLabel;
      day.appendChild(tag);

      const ul = document.createElement('ul');
      ul.className = 'acts';
      ul.setAttribute('aria-label', 'Line-up ' + dayLabel);

      acts.forEach(a => {
        const li = document.createElement('li');
        // Klickbarer Name als "unsichtbarer Button"
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'lu-act'; // keine Styles; Optik bleibt wie Text
        btn.setAttribute('aria-haspopup','dialog');
        btn.textContent = a.artist || "–";
        btn.addEventListener('click', ()=>{
          openModal({
            title: a.artist,
            time: fmtTime(a.start, a.end),
            desc: a.description,
            image: a.image
          });
        });
        li.appendChild(btn);
        ul.appendChild(li);
      });

      day.appendChild(ul);
      return day;
    }

    async function load(){
      let text = "";
      try {
        const res = await fetch(CSV_URL, { cache: 'no-store' });
        text = await res.text();
      } catch(e){
        console.error("CSV konnte nicht geladen werden:", e);
        return;
      }

      const parsed = Papa.parse(text, { header: true, skipEmptyLines: true });
      const rows = (parsed.data || []).filter(r => Object.values(r).some(v => norm(v)));
      if (!rows.length) return;

      const groups = []; // [{key, label, items: []}] – Reihenfolge wie im CSV
      const byKey = new Map();

      const DAY_KEYS  = ["day","tag","wochentag","datum"];
      const START_KEYS= ["start","startzeit","beginn"];
      const END_KEYS  = ["end","ende","endzeit"];
      const ART_KEYS  = ["artist","band","name","bandname"];
      const DESC_KEYS = ["description","beschreibung","text","info"];
      const IMG_KEYS  = ["image","bild","bildurl","foto","image_url","url"];

      for (const row of rows){
        const artist = pick(row, ART_KEYS);
        if (!artist) continue;

        const dayRaw = pick(row, DAY_KEYS) || "";
        const start = pick(row, START_KEYS);
        const end   = pick(row, END_KEYS);
        const description = pick(row, DESC_KEYS);
        const image = imgURL(pick(row, IMG_KEYS));

        const key = lc(dayRaw) || "lineup";
        if (!byKey.has(key)){
          const label = normalizeDayLabel(dayRaw || "Line-up");
          const entry = { key, label, items: [] };
          byKey.set(key, entry);
          groups.push(entry);
        }
        byKey.get(key).items.push({ artist, start, end, description, image, t: timeToMinutes(start) });
      }

      groups.forEach(g => g.items.sort((a,b)=> a.t - b.t ));

      for (const g of groups){
        root.appendChild(renderDayBlock(g.label, g.items));
      }

      // Trigger dein vorhandenes "row-start" Skript nach dem Rendern
      setTimeout(()=> window.dispatchEvent(new Event('resize')), 0);
    }

    load();
  })();
  </script>

  <!-- JS: Line-up – kein Punkt am Zeilenanfang (unverändert) -->
  <script>
  (function () {
    function updateLineupSeparators() {
      document.querySelectorAll('.lineup .acts').forEach(ul => {
        const items = Array.from(ul.children);
        let lastTop = null;
        items.forEach((li, idx) => {
          li.classList.remove('row-start');
          const t = li.offsetTop;
          if (idx === 0 || lastTop === null || Math.abs(t - lastTop) > 1) {
            li.classList.add('row-start');
            lastTop = t;
          }
        });
      });
    }
    const debounce = (() => { let id; return () => { clearTimeout(id); id = setTimeout(updateLineupSeparators, 100); }; })();
    window.addEventListener('load', updateLineupSeparators);
    window.addEventListener('resize', debounce);
    window.addEventListener('orientationchange', debounce);
    if (document.fonts && document.fonts.ready) { document.fonts.ready.then(updateLineupSeparators); }
  })();
  </script>
</body>
</html>
