<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fête du Seeee 2025 im Strandbad Tegelsee | Kulturinsel Moabit</title>
  <meta name="description" content="Erlebe das ehrenamtliche Musikfestival Fête du Seeee am 29.–30.08.2025 im Strandbad Tegelsee. Jetzt Programm entdecken!" />
  <link rel="canonical" href="https://kulturinselmoabit.org/fete/" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml" />

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;800&display=swap" rel="stylesheet" />
  <!-- „gestempelte“ Schrift nur fürs Line-up -->
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Dirt&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="../styles.css?v=fete-dialog-fix-1" />
  <style>
    :root {
      --bg:        #EDE4D9;
      --primary:   #016DAF;
      --highlight: #FC411F;
      --col1:      200px;
      --gap-col:   1fr;
      --gutter:    2rem;
      --pad-lg:    2rem;
      --pad-sm:    .75rem;
    }

    /* Reset */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* Body */
    body {
      background: var(--bg);
      color: var(--primary);
      font-family: 'Montserrat', sans-serif;
      line-height: 1.4;
      padding: 0 var(--pad-lg);
    }
    @media (max-width: 768px) {
      body { padding: 0 var(--pad-sm); }
      .page-text img.fullwidth,
      .page-text img.float-left-third,
      .page-text img.float-right-third,
      .page-text img.float-half-left,
      .page-text img.float-half-right {
        float: none !important;
        width: 100% !important;
        margin: 0 auto 1em !important;
        display: block;
      }
    }

    /* Container */
    .container { max-width: 60rem; margin: 0 auto; }

    /* HEADER */
    #site-header { position: relative; background: var(--bg); border-bottom: 2px solid var(--primary); }
    .header-inner {
      display: grid;
      grid-template-columns: var(--col1) repeat(5, var(--gap-col));
      column-gap: var(--gutter);
      align-items: flex-end;
      padding: 1rem 0;
    }

    /* Logo */
    .logo img { width: var(--col1); display: block; object-fit: contain; }

    /* NAVIGATION */
    .site-nav { grid-column: 2 / -1; }
    .site-nav ul {
      display: flex; justify-content: space-between; align-items: flex-end;
      gap: 1rem; list-style: none; margin: 0; padding: 0;
    }
    .site-nav ul.open { display: flex; flex-direction: column; grid-column: auto; margin-top: .5rem; background: var(--bg); align-items: center; }
    .site-nav ul.open li + li { border-top: none; }
    .site-nav a {
      display: block; text-align: center; white-space: nowrap; text-decoration: none;
      color: var(--primary); font-weight: 700; padding: .75rem 0; position: relative;
    }
    .site-nav a::after {
      content: ''; position: absolute; left: 50%; bottom: 0; transform: translateX(-50%);
      width: 0; height: 2px; background: var(--highlight); transition: width .25s ease;
    }
    .site-nav a:hover::after { width: 100%; }

    /* Hamburger-/Close-Icon */
    .menu-toggle { display: none; background: none; border: none; cursor: pointer; position: absolute; top: calc(1rem + 5px); right: var(--pad-sm); z-index: 1000; }
    .menu-toggle span { display: block; width: 25px; height: 3px; margin: 4px 0; background: var(--primary); transition: transform .3s, opacity .3s; }
    .menu-toggle.open span:nth-child(1) { transform: translateY(7px) rotate(45deg); }
    .menu-toggle.open span:nth-child(2) { opacity: 0; }
    .menu-toggle.open span:nth-child(3) { transform: translateY(-7px) rotate(-45deg); }

    /* PAGE SECTION */
    .page-inner {
      display: grid;
      grid-template-columns: var(--col1) repeat(5, var(--gap-col));
      column-gap: var(--gutter);
      align-items: start;
      padding: 6rem 0;
    }
    .page-img img {
      width: var(--col1); height: var(--col1); object-fit: cover; border-radius: 50%; display: block;
    }

    /* Textbereich */
    .page-text { grid-column: 2 / -1; }
    .page-text h1 { font-size: clamp(2rem,5vw,2.5rem); font-weight: 800; margin-bottom: 1rem; line-height: 1.2; }
    .page-text h2 { font-size: 1.5rem; font-weight: 600; margin: 2rem 0 1rem; }
    .page-text h3 { font-size: 1 rem; font-weight: 700; margin: 1.5rem 0 .75rem; }
    .page-text .divider { width: 3rem; height: 1px; background: var(--highlight); margin: 0 auto 2rem; border: none; }
    .page-text .divider_long { width: 9rem; height: 1px; background: var(--highlight); margin: 0 auto 2rem; border: none; }
    .page-text p { margin-bottom: 1.5rem; font-size: 1rem; line-height: 1.2; text-align: justify; }
    .page-text img.fullwidth { width: 100%; height: auto; display: block; float: none; margin: 0; }

    /* ----------Bilder im Text-------------- */
    .page-text img.float-left-third   { float: left;  width: 33.333%; height: auto; margin: 0 1em 1em 0; display: block; box-shadow: 0 0 8px rgba(0,0,0,.1); }
    .page-text img.float-right-third  { float: right; width: 33.333%; height: auto; margin: 0 0 1em 1em; display: block; box-shadow: 0 0 8px rgba(0,0,0,.1); }
    .page-text img.float-half-left    { float: left;  width: 50%;    height: auto; margin: 0 1em 1em 0; display: block; box-shadow: 0 0 8px rgba(0,0,0,.1); }
    .page-text img.float-half-right   { float: right; width: 50%;    height: auto; margin: 0 0 1em 1em; display: block; box-shadow: 0 0 8px rgba(0,0,0,.1); }

    /* Aufräum-Clearfix nach schwimmenden Elementen */
    .page-text::after { content: ""; display: block; clear: both; }
    .page-text ul { margin-left: 1.5rem; padding-left: .5rem; list-style-position: outside; }
    .page-text a { color: var(--primary); text-decoration: underline; }
    .page-text a:hover { color: var(--highlight); }
    .page-text .btn-primary { display: inline-block; margin-top: 2rem; background: var(--highlight); color: #fff; padding: 1rem 2.5rem; border-radius: 4px; font-weight: 700; text-decoration: none; transition: transform .15s ease; }
    .page-text .btn-primary:hover { transform: translateY(-2px); }

    /* Index-Galerie */
    .index-gallery { display: flex; flex-direction: column; gap: var(--gutter); padding: 6rem 0; }
    .index-gallery__wide { width: 100%; aspect-ratio: 3 / 1; overflow: hidden; }
    .index-gallery__wide-img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .index-gallery__quads { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--gutter); }
    .index-gallery__quad { width: 100%; aspect-ratio: 1 / 1; overflow: hidden; }
    .index-gallery__quad-img { width: 100%; height: 100%; object-fit: cover; display: block; }

    /* FOOTER */
    #site-footer { background: var(--bg); border-top: 2px solid var(--primary); }
    .footer-inner { padding: 2rem 0; text-align: center; font-size: .9rem; }
    #site-footer a { color: var(--primary); text-decoration: none; font-weight: 600; margin: 0 .5rem; }
    #site-footer a:hover { text-decoration: underline; }

    /* MOBILE */
    @media (max-width: 768px) {
      .header-inner { display: flex; flex-direction: column; align-items: center; }
      .site-nav { grid-column: auto; margin-top: .5rem; }
      .site-nav ul { display: none; }
      .site-nav ul.open { display: flex; flex-direction: column; }
      .menu-toggle { display: block; }
      .logo, .page-img { padding: 0 var(--pad-sm); }
      .page-inner { display: flex !important; flex-direction: column; gap: var(--gutter); align-items: center; }
      .page-img { margin-bottom: var(--gutter); }
      .page-text h1, .page-text h2, .page-text h3 { text-align: center; }
    }

    /* — QR-Code-Override — */
    .page-text img.qr-code { width: 150px; height: auto; display: block; margin: 1.5rem 0; object-fit: contain; }
    @media (max-width: 768px) { .page-text img.qr-code { width: 120px; height: auto; } }

    /* =====================================================================
       ===============  NUR FÜR DIE FÊTE-SEITE (namespaced)  ===============
       ===================================================================== */

    .fete-page {
      /* Bands ~1/3 kleiner */
      --lineup-min: 1.2rem;
      --lineup-vw:  3.33vw;
      --lineup-max: 2rem;
      --lineup-row-gap: .6em;
    }

    /* Vollbreit-Text in der Fête-Seite (Bildspalte weg) */
    .fete-page .page-img { display: none; }
    .fete-page .page-text { grid-column: 1 / -1; }

    /* Banner */
    .fete-page .fete-banner { margin: .2rem 0 1rem; }
    .fete-page .fete-banner-img { display:block; width:100%; height:auto; }

    /* Meta-Zeile */
    .fete-page .fete-meta {
      width: 100%;
      display: flex; justify-content: center; align-items: center; gap: .6rem;
      margin: .25rem 0 1.25rem;
      font-weight: 800; letter-spacing: .03em;
      font-size: clamp(1.1rem, 2.3vw, 1.4rem);
    }
    .fete-page .fete-meta .sep { color: var(--highlight); }
    @media (max-width: 560px){
      .fete-page .fete-meta { flex-direction: column; gap: .25rem; }
      .fete-page .fete-meta .sep { display: none; }
    }

    /* Intro-Text */
    .fete-page .info-block { margin: 1rem 0 2rem; }

    /* Slideshow – clean */
    .fete-page .fete-hero { margin: 1rem 0 2rem; }
    .fete-page .fete-slider {
      position: relative;
      width: 100%;
      max-width: 100%;
      aspect-ratio: 16 / 9;
      overflow: hidden;
      border: none;
      border-radius: 8px;
      background: #ddd;
    }
    .fete-page .fete-slide {
      position: absolute; inset: 0;
      opacity: 0; transition: opacity .35s ease; pointer-events: none;
    }
    .fete-page .fete-slide.active { opacity: 1; pointer-events: auto; }
    .fete-page .fete-slide img,
    .fete-page .fete-slide video { width: 100%; height: 100%; object-fit: cover; display: block; }

    /* Controls – clean */
    .fete-page .fete-control {
      position: absolute; top: 50%; transform: translateY(-50%);
      border: none; background: rgba(255,255,255,.75); color: var(--primary);
      font-weight: 800; width: 2rem; height: 2rem; line-height: 2rem; border-radius: 999px;
      text-align: center; cursor: pointer; z-index: 2;
    }
    .fete-page .fete-control:hover { background: rgba(255,255,255,.95); }
    .fete-page .fete-control.prev { left: .6rem; }
    .fete-page .fete-control.next { right: .6rem; }

    /* Dots – clean */
    .fete-page .fete-dots {
      position: absolute; left: 0; right: 0; bottom: .5rem;
      display: flex; justify-content: center; gap: .4rem; padding: 0 .5rem; z-index: 2;
    }
    .fete-page .fete-dot {
      width: .5rem; height: .5rem; border-radius: 999px;
      border: 1px solid var(--primary); background: rgba(255,255,255,.85); cursor: pointer;
    }
    .fete-page .fete-dot.active { background: var(--highlight); border-color: var(--highlight); }

    /* LINE-UP */
    .fete-page .lineup { margin: 2.2rem 0 2rem; }
    .fete-page .lineup-wrap { text-align: center; }

    /* Überschriften (Line-Up & Eintritt) */
    .fete-page .lineup .lineup-heading,
    .fete-page .section-title{
      display:inline-block;
      font-family: 'Montserrat', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      font-weight: 800;
      color: var(--primary);
      text-transform: uppercase;
      letter-spacing: .04em;
      font-size: clamp(1.8rem, 4.2vw, 2.6rem);
      margin: .25rem 0 1rem;
      position: relative;
      padding-bottom: .2rem;
    }
    .fete-page .lineup .lineup-heading::after,
    .fete-page .section-title::after{
      content:"";
      position:absolute; left:0; right:0; bottom:-.2rem;
      height:.18rem; background: var(--highlight);
      border-radius: 2px;
    }

    /* Day-Tag */
    .fete-page .lineup .lineup-daytag{
      display: inline-block; background: var(--primary); color: #fff;
      font-weight: 800; letter-spacing: .06em; border-radius: 6px;
      padding: .35rem .6rem; font-size: .95rem; margin: .25rem 0 .75rem 0;
    }

    /* Acts */
    .fete-page .lineup .acts{
      list-style: none; margin: 0 0 1.4rem 0; padding: 0;
      display: flex; flex-wrap: wrap; justify-content: center; align-items: center;
      row-gap: var(--lineup-row-gap); text-align: center;
    }
    .fete-page .lineup .acts li{
      font-family: "Rubik Dirt", "Montserrat", sans-serif;
      text-transform: uppercase; letter-spacing: .03em; line-height: 1.15;
      color: var(--primary);
      font-size: clamp(var(--lineup-min), var(--lineup-vw), var(--lineup-max));
      margin: 0 .8em;                 /* Abstand links/rechts */
      overflow-wrap: normal;          /* keine automatische Trennung */
      word-break: keep-all;           /* ganze Wörter umbrechen */
      hyphens: manual;                /* nur manuelle Trennung */
    }

    /* Klickfläche Bandname (wie Text) + rote Hover-Underline */
    .fete-page .lineup .acts .lu-act{
      background: none; border: null; padding: 0; margin: 0;
      font: inherit; color: inherit; text-transform: inherit; letter-spacing: inherit;
      cursor: pointer; position: relative;
    }
    .fete-page .lineup .acts .lu-act::after{
      content: '';
      position: absolute;
      left: 0; right: 0; bottom: -0.15em;
      height: 0.18rem;
      background: var(--highlight);
      transform: scaleX(0);
      transform-origin: center;
      transition: transform .25s ease;
    }
    .fete-page .lineup .acts .lu-act:hover::after,
    .fete-page .lineup .acts .lu-act:focus-visible::after{
      transform: scaleX(1);
    }
    .fete-page .lineup .acts .lu-act:focus-visible{
      outline: 2px solid var(--highlight);
      outline-offset: 2px;
    }

    /* Keine Punkte zwischen Bands */
    .fete-page .lineup .acts li + li::before{ content: none; }

    @media (max-width: 768px) {
      .fete-page .lineup { margin: 1.6rem 0 2rem; }
      .fete-page .lineup .lineup-daytag { margin-top: .5rem; }
    }

    /* Eintritt */
    .fete-page .entry { margin: .75rem 0 2rem; text-align: left; }
    .fete-page .entry p { margin-bottom: .75rem; }
    .fete-page .entry ul { list-style: none; margin: 0 0 1rem 0; padding: 0; }
    .fete-page .entry li { margin: .25rem 0; }
    /* "Eintritt" zentriert mit Linie in Textbreite */
    .fete-page .entry .section-title{
      display: block;
      width: max-content;
      margin: .25rem auto 1rem;
      text-align: center;
    }

    /* ================= Modal / Bottom-Sheet (nur Fête) ================== */
    /* Dialog selbst als fullscreen Overlay-Container; Card wird darin zentriert */
    .fete-page .lu-dialog {
      border: none;
      background: transparent;
      padding: 0;
      margin: 0;
      inset: 0;                 /* volle Viewport-Fläche */
      width: 100vw;
      height: 100vh;
      max-width: none;
      display: grid;            /* zentrieren am Desktop */
      place-items: center;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    .fete-page .lu-dialog[open] {
      opacity: 1;
      visibility: visible;
    }
    .fete-page .lu-dialog::backdrop {
      background: rgba(0,0,0,.45);
    }

    /* Die sichtbare Box */
    .fete-page .lu-card {
      background: var(--bg);
      color: var(--primary);
      border: none;
      border-radius: 14px;
      width: min(92vw, 720px);
      max-width: 100%;
      max-height: 85vh;         /* begrenzen */
      display: grid;
      grid-template-rows: auto 1fr;
      overflow: hidden;         /* Medien fixieren, Inhalt scrollt */
      position: relative;
      transform: translateY(20px);
      transition: transform 0.3s ease;
    }
    .fete-page .lu-dialog[open] .lu-card {
      transform: translateY(0);
    }

    /* Bild-Bereich */
    .fete-page .lu-media-wrap { display: none; background:#ddd; }
    .fete-page .lu-media {
      display: block; width: 100%; height: auto;
      aspect-ratio: 16/9; object-fit: cover;
    }

    /* Textbereich – SCROLLBAR für lange Inhalte */
    .fete-page .lu-content {
      padding: 1rem 1rem 1.25rem;
      overflow: auto;                 /* <-- Scrollbar */
      -webkit-overflow-scrolling: touch;
      scrollbar-gutter: stable both-edges;
    }

    .fete-page .lu-title {
      font-size: clamp(1.2rem, 3.5vw, 1.6rem);
      font-weight: 800; margin-bottom: .4rem;
    }
    .fete-page .lu-time {
      font-weight: 700; margin-bottom: .6rem;
    }
    .fete-page .lu-desc {
      white-space: pre-wrap;
      line-height: 1.35;
    }

    /* Close-Button */
    .fete-page .lu-close{
      position: absolute; top: .5rem; right: .75rem;
      background: rgba(255,255,255,.9);
      border: none; border-radius: 999px;
      width: 32px; height: 32px; line-height: 32px;
      font-size: 20px; font-weight: 800; color: var(--primary);
      cursor: pointer;
      z-index: 10;
    }
    .fete-page .lu-close:focus-visible{ outline: 2px solid var(--highlight); outline-offset: 2px; }

    /* Mobile: Bottom-Sheet */
    @media (max-width: 768px){
      .fete-page .lu-dialog{
        place-items: end center;  /* unten andocken */
      }
      .fete-page .lu-card{
        width: 100vw;
        max-height: 90vh;         /* höher auf kleinen Screens */
        border-bottom-left-radius: 0;
        border-bottom-right-radius: 0;
      }
    }

    /* Mobile-Polish nur für Fête */
    @media (max-width: 768px) {
      .fete-page .page-text { padding-inline: 12px; }
      .fete-page .fete-slider { margin-inline: 0; }
      .fete-page .fete-banner,
      .fete-page .fete-meta,
      .fete-page .lineup,
      .fete-page .entry,
      .fete-page .info-block {
        max-width: 100%;
        margin-inline: 0;
        padding-inline: 2px;
      }
    }
    .fete-page img,
    .fete-page video {
      display: block;
      max-width: 100%;
      height: auto;
      box-sizing: border-box;
    }
    .fete-page { overflow-x: hidden; }
    .fete-page .lineup .acts { padding-inline: .25rem; }
    .fete-page .fete-slider { overflow: hidden; }
    .fete-page .fete-dots { padding: 0 .35rem; }
    .fete-page .fete-control { width: 2rem; height: 2rem; line-height: 2rem; }
  </style>
</head>
<body class="fete-page">

  <!-- HEADER -->
  <header id="site-header">
    <div class="container header-inner">
      <div class="logo">
        <img src="/logo.svg" alt="Logo Kulturinsel Moabit" />
      </div>
      <nav class="site-nav">
        <button class="menu-toggle" aria-label="Menü öffnen / schließen">
          <span></span><span></span><span></span>
        </button>
        <ul>
          <li><a href="/">Startseite</a></li>
          <li><a href="/fete/" class="active">Fête du Seeee</a></li>
          <li><a href="/jam/">Jamsession</a></li>
          <li><a href="/mitmachen/">Mitmachen</a></li>
          <li><a href="/uber-uns/">Über uns</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- MAIN -->
  <main>
    <section class="container page-inner page-inner--wide">
      <div class="page-text">

        <!-- Banner (einfaches IMG) -->
        <section class="fete-banner" aria-label="Festival-Banner">
          <img class="fete-banner-img" src="fete-banner.svg" alt="Fête du Seeee – Banner" />
        </section>

        <!-- Meta-Zeile -->
        <div class="fete-meta">
          <span>Strandbad Tegelsee</span>
          <span class="sep">•</span>
          <span>29. &amp; 30. August 2025</span>
        </div>

        <!-- Intro-Text -->
        <section class="info-block">
          <p>
            Dieses Jahr wird unsere Fête du Seeee noch bunter und größer:
            Wir feiern an zwei Tagen auf gleich <strong>zwei Bühnen</strong> im wunderschönen
            Strandbad Tegelsee! Freut euch auf ein vielseitiges Programm aus Musik, Theater und Kunst,
            das von ehrenamtlichen Künstler*innen für euch gestaltet wird.
          </p>
          <p>
            Genießt tagsüber Kultur-Highlights und bunte Aktionen für Groß und Klein direkt am Wasser,
            und lasst euch abends von mitreißenden Konzerten und Performances auf beiden Bühnen mitreißen.
            Bei den unterschiedlichsten Genres ist für jeden Geschmack etwas dabei!
          </p>
        </section>

        <!-- SLIDESHOW -->
        <section class="fete-hero">
          <div class="fete-slider" id="feteSlider" aria-label="Festival-Impressionen">
            <button class="fete-control prev" aria-label="Vorheriges">‹</button>
            <button class="fete-control next" aria-label="Nächstes">›</button>
            <div class="fete-dots" role="tablist" aria-label="Slideshow-Navigation"></div>
          </div>
          <noscript>
            <img src="1.jpg" alt="Festivalbild 1" style="width:100%;height:auto;border-radius:8px;display:block;margin-top:.5rem;">
          </noscript>
        </section>

        <!-- ===== LINE-UP ===== -->
        <section class="lineup">
          <div class="lineup-wrap">
            <div class="lineup-heading">Line-Up</div>

            <!-- Dynamisch erzeugter Inhalt -->
            <div id="lineupRoot" aria-live="polite">
              <div style="margin:.5rem 0; font-weight:700;">Lade Line-up …</div>
            </div>
            <div id="luError" style="margin-top:.5rem;font-weight:700;color:#FC411F;display:none;"></div>
          </div>
        </section>
        <!-- ===== /LINE-UP ===== -->

        <!-- Eintritt -->
        <section class="entry">
          <h2 class="section-title">Eintritt</h2>
          <p><strong>nur Strandbadeintritt:</strong></p>
          <ul>
            <li>Erwachsene: 6 €</li>
            <li>Ermäßigt: 4 €</li>
            <li>Ab 18 Uhr: 2,50 €</li>
          </ul>
          <p>
            Kommt vorbei, bringt eure Freund*innen mit und lasst uns gemeinsam am
            Tegeler See feiern – wir freuen uns auf euch!
          </p>
        </section>

      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer id="site-footer">
    <div class="container footer-inner">
      <p>
        <a href="/impressum.html">Impressum</a> |
        <a href="/kontakt.html">Kontakt</a> |
        <a href="/datenschutz.html">Datenschutz</a>
      </p>
      <p>© 2025 Kulturinsel Moabit – alle Rechte vorbehalten</p>
    </div>
  </footer>

  <!-- Modal / Bottom-Sheet -->
  <!-- WICHTIG: kein 'open' Attribut im Markup -->
  <dialog id="luDialog" class="lu-dialog" aria-label="Banddetails">
    <form method="dialog" class="lu-card">
      <button class="lu-close" aria-label="Schließen">×</button>
      <div class="lu-media-wrap">
        <img class="lu-media" alt="" loading="lazy" />
      </div>
      <div class="lu-content">
        <h3 class="lu-title"></h3>
        <div class="lu-time"></div>
        <div class="lu-desc"></div>
      </div>
    </form>
  </dialog>

  <!-- JS: Burger-Menü -->
  <script>
    const btn = document.querySelector('.menu-toggle');
    const nav = document.querySelector('.site-nav ul');
    if (btn && nav) {
      btn.addEventListener('click', () => {
        nav.classList.toggle('open');
        btn.classList.toggle('open');
      });
    }
  </script>

  <!-- JS: Slideshow-Loader (robust, JPG/MP4 1–9) -->
  <script>
  (function(){
    const slider = document.getElementById('feteSlider');
    if (!slider) return;

    let prevBtn = slider.querySelector('.fete-control.prev');
    let nextBtn = slider.querySelector('.fete-control.next');
    let dotsWrap = slider.querySelector('.fete-dots');

    function mk(tag, cls, txt){
      const el = document.createElement(tag);
      if (cls) el.className = cls;
      if (txt != null) el.textContent = txt;
      return el;
    }
    if (!prevBtn){ prevBtn = mk('button','fete-control prev','‹'); prevBtn.setAttribute('aria-label','Vorheriges'); slider.appendChild(prevBtn); }
    if (!nextBtn){ nextBtn = mk('button','fete-control next','›'); nextBtn.setAttribute('aria-label','Nächstes'); slider.appendChild(nextBtn); }
    if (!dotsWrap){ dotsWrap = mk('div','fete-dots'); dotsWrap.setAttribute('role','tablist'); dotsWrap.setAttribute('aria-label','Slideshow-Navigation'); slider.appendChild(dotsWrap); }

    function folderPath(){
      const p = location.pathname;
      if (p.endsWith('/')) return p;
      if (/\/index\.html?$/i.test(p)) return p.replace(/index\.html?$/i,'');
      if (p.includes('.')) return p.replace(/[^/]+$/, '');
      return p + '/';
    }
    const base = location.origin + folderPath();

    function loadImage(url){
      return new Promise(resolve=>{
        const img = new Image();
        img.onload  = ()=>resolve({ok:true, node:img});
        img.onerror = ()=>resolve({ok:false});
        img.decoding = 'async';
        img.src = url;
      });
    }
    function loadVideo(url){
      return new Promise(resolve=>{
        const v = document.createElement('video');
        v.preload='metadata'; v.muted=true; v.playsInline=true; v.setAttribute('playsinline',''); v.loop=true;
        const ok=()=>{ cleanup(); resolve({ok:true, node:v}); };
        const err=()=>{ cleanup(); resolve({ok:false}); };
        function cleanup(){ v.removeEventListener('loadedmetadata', ok); v.removeEventListener('error', err); }
        v.addEventListener('loadedmetadata', ok);
        v.addEventListener('error', err);
        v.src = url;
      });
    }
    async function probe(n){
      const jpg = base + `${n}.jpg`;
      let r = await loadImage(jpg);
      if (r.ok){ r.node.alt = `Festivalbild ${n}`; return {idx:n, node:r.node}; }
      const mp4 = base + `${n}.mp4`;
      r = await loadVideo(mp4);
      if (r.ok){ return {idx:n, node:r.node}; }
      return null;
    }

    (async function init(){
      const results = await Promise.all(Array.from({length: 9}, (_,i)=>probe(i+1)));
      const items = results.filter(Boolean).sort((a,b)=>a.idx - b.idx);
      if (!items.length) return;

      const slides = [], dots = [];
      function addSlide(node, i){
        const wrap = mk('div','fete-slide');
        wrap.setAttribute('data-index', i);
        wrap.setAttribute('aria-hidden','true');
        wrap.appendChild(node);
        slider.insertBefore(wrap, dotsWrap);

        const dot = mk('button','fete-dot');
        dot.type='button';
        dot.setAttribute('aria-label','Slide '+(i+1));
        dotsWrap.appendChild(dot);

        slides.push(wrap); dots.push(dot);
      }
      items.forEach((it,i)=>addSlide(it.node, i));

      slider.appendChild(prevBtn);
      slider.appendChild(nextBtn);
      slider.appendChild(dotsWrap);

      let current = 0;
      function show(i){
        current = (i + slides.length) % slides.length;
        slides.forEach((el, idx)=>{
          const active = idx === current;
          el.classList.toggle('active', active);
          el.setAttribute('aria-hidden', active ? 'false' : 'true');
          const v = el.querySelector('video');
          if (v){ active ? v.play().catch(()=>{}) : v.pause(); }
        });
        dots.forEach((d, idx)=>d.classList.toggle('active', idx === current));
      }

      prevBtn.addEventListener('click', ()=>show(current - 1));
      nextBtn.addEventListener('click', ()=>show(current + 1));

      slider.setAttribute('tabindex','0');
      slider.addEventListener('keydown', e=>{
        if (e.key === 'ArrowLeft')  show(current - 1);
        if (e.key === 'ArrowRight') show(current + 1);
      });

      let sx=null;
      slider.addEventListener('touchstart', e=>{ sx = e.touches[0].clientX; }, {passive:true});
      slider.addEventListener('touchend',   e=>{
        if (sx==null) return;
        const dx = e.changedTouches[0].clientX - sx;
        if (Math.abs(dx) > 40) (dx < 0 ? show(current + 1) : show(current - 1));
        sx = null;
      });

      show(0);

      // Autoplay (5s)
      let timer = null, hover = false;
      function next(){ nextBtn.click(); }
      function start(){ if (!timer && slides.length > 1) timer = setInterval(()=>{ if (!hover && !document.hidden) next(); }, 5000); }
      function stop(){ clearInterval(timer); timer = null; }
      slider.addEventListener('mouseenter',()=>hover=true);
      slider.addEventListener('mouseleave',()=>hover=false);
      slider.addEventListener('touchstart', ()=>hover=true, {passive:true});
      slider.addEventListener('touchend',   ()=>hover=false, {passive:true});
      document.addEventListener('visibilitychange', ()=>{ document.hidden ? stop() : start(); });
      start();
    })();
  })();
  </script>

  <!-- PapaParse (CDN) – ohne SRI & crossorigin -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <!-- JS: Dynamisches Line-up aus Google Sheets CSV -->
  <script>
  (function(){
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRkYgQhBk53GOGABV_qzv3ZqjgSfR61ZH9_fX-uejRTUOQ4EtAgARUXXIayqaPKWRr5hBRMCH219-_j/pub?output=csv";
    const IMG_BASE = "bandinfo/img/"; // relativ zu /fete/

    const root   = document.getElementById('lineupRoot');
    const errBox = document.getElementById('luError');
    const dlg    = document.getElementById('luDialog');

    // SAFEGUARD: Dialog sicher geschlossen beim Start
    if (dlg) {
      try { dlg.close(); } catch(_) {}
      dlg.removeAttribute('open');
    }

    if (!root) return;

    const showError = (msg) => { if (errBox){ errBox.style.display=''; errBox.textContent = msg; }};

    const stripBOM = (s) => String(s ?? '').replace(/^\uFEFF/, '');
    const clean = (s) => stripBOM(String(s ?? '').trim());

    const normalizeKey = (k) => stripBOM(String(k||''))
      .toLowerCase().trim().replace(/\s+/g,'')
      .replace(/bandname|name|band/, 'artist')
      .replace(/beschreibung|beschreib|desc|descriptiontext/, 'description')
      .replace(/bildurl|bild|imageurl/, 'image')
      .replace(/^tag$/, 'day')
      .replace(/^zeit$|^time$/, 'start')
      .replace(/^startzeit$/, 'start')
      .replace(/^endzeit$/, 'end');

    const parseTime = (t) => {
      const raw = clean(t);
      if (!raw) return null;
      let s = raw;
      if (/^\d{1,2}$/.test(s)) s = s + ':00';
      s = s.replace('.', ':');
      const m = s.match(/^(\d{1,2}):(\d{2})$/);
      if (!m) return null;
      const hh = +m[1], mm = +m[2];
      if (hh<0||hh>23||mm<0||mm>59) return null;
      return String(hh).padStart(2,'0') + ':' + String(mm).padStart(2,'0');
    };

    const labelForDay = (dayRaw) => {
      const d = clean(dayRaw).toLowerCase();
      if (/^(fr|fri|freitag|fr\.|friday)$/.test(d)) return "FR. 29. AUGUST · ab 14 Uhr";
      if (/^(sa|sam|samstag|sa\.|saturday)$/.test(d)) return "SA. 30. AUGUST · ab 12 Uhr";
      return clean(dayRaw) || "Tag";
    };

    function buildImgSrc(image){
      const v = clean(image);
      if (!v) return '';
      if (/^https?:\/\//i.test(v) || v.startsWith('//')) return v;
      return (IMG_BASE || '') + v.replace(/^\/+/, '');
    }

    function groupByDay(rows){
      const order = [];
      const map = {};
      rows.forEach(r=>{
        const dayRaw = clean(r.day);
        if (!dayRaw) return;
        if (!map[dayRaw]) { map[dayRaw] = []; order.push(dayRaw); }
        map[dayRaw].push(r);
      });
      return {order, map};
    }

    function renderDayBlock(dayRaw, acts){
      const line = document.createElement('div');
      line.className = 'line';

      const tag = document.createElement('div');
      tag.className = 'lineup-daytag';
      tag.textContent = labelForDay(dayRaw);
      line.appendChild(tag);

      const ul = document.createElement('ul');
      ul.className = 'acts';
      ul.setAttribute('role','list');

      acts.forEach(a=>{
        const li = document.createElement('li');
        const btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'lu-act';
        btn.textContent = a.artist;
        btn.addEventListener('click', ()=>openDialog(a));
        li.appendChild(btn);
        ul.appendChild(li);
      });

      line.appendChild(ul);
      return line;
    }

    function escapeHtml(s){
      return String(s ?? "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }

    function openDialog(a){
      const imgEl  = dlg.querySelector('.lu-media');
      const title  = dlg.querySelector('.lu-title');
      const timeEl = dlg.querySelector('.lu-time');
      const desc   = dlg.querySelector('.lu-desc');

      // Bild
      const src = buildImgSrc(a.image);
      if (src){
        const wrap = dlg.querySelector('.lu-media-wrap');
        wrap.style.display = '';
        imgEl.src = src;
        imgEl.alt = a.artist ? `Foto: ${a.artist}` : "Bandfoto";
        imgEl.onerror = ()=>{ wrap.style.display='none'; };
      } else {
        dlg.querySelector('.lu-media-wrap').style.display = 'none';
        imgEl.src = '';
        imgEl.alt = '';
      }

      title.textContent = a.artist || '';
      timeEl.textContent = (a.start && a.end) ? `${a.start}–${a.end}` : (a.start || '');

      const rawDesc = a.description || "";
      const normalized = rawDesc.replace(/\r\n?|\n|\\n/g, "\n");
      const safe = escapeHtml(normalized).replace(/\n/g,"<br>");
      desc.innerHTML = safe;

      if (typeof dlg.showModal === 'function') dlg.showModal();
      else dlg.setAttribute('open','');
    }

    function extractDescription(origRow, normalizedRow){
      if (normalizedRow.description != null && String(normalizedRow.description).trim() !== "") {
        return normalizedRow.description;
      }
      let hit = "";
      for (const k of Object.keys(origRow)){
        const kk = String(k).toLowerCase().trim();
        if (/(beschreib|descr)/.test(kk)) {
          const v = origRow[k];
          if (v != null && String(v).trim() !== "") { hit = v; break; }
        }
      }
      return hit;
    }

    function startLineup(){
      Papa.parse(CSV_URL, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: (res)=>{
          try {
            const rows = (res.data || []).map(orig=>{
              const norm = {};
              Object.keys(orig).forEach(k=>{ norm[ normalizeKey(k) ] = orig[k]; });

              const artist = clean(norm.artist ?? norm.name);
              const day    = clean(norm.day);
              const start  = parseTime(norm.start);
              const end    = parseTime(norm.end);
              const image  = clean(norm.image);
              const descriptionRaw = extractDescription(orig, norm);
              const description = String(descriptionRaw ?? "");

              if (!artist || !day) return null;
              return { artist, day, start, end, image, description };
            }).filter(Boolean);

            root.innerHTML = '';
            if (!rows.length){ showError('Keine Einträge in der CSV gefunden.'); return; }

            const {order, map} = groupByDay(rows);
            order.forEach(dayRaw=>{
              const acts = map[dayRaw].sort((a,b)=>{
                if (a.start && b.start) return a.start.localeCompare(b.start);
                if (a.start) return -1;
                if (b.start) return 1;
                return a.artist.localeCompare(b.artist);
              });
              root.appendChild( renderDayBlock(dayRaw, acts) );
            });
          } catch(e){
            console.error(e); showError('Fehler beim Verarbeiten der CSV.');
          }
        },
        error: (err)=>{ console.error(err); showError('CSV konnte nicht geladen werden.'); }
      });
    }

    if (window.Papa) startLineup();
    else window.addEventListener('load', ()=>{ if (window.Papa) startLineup(); });

    // Dialog schließen (Klick außerhalb, ESC, Close-Button)
    if (dlg){
      dlg.addEventListener('click', (e)=>{
        const card = dlg.querySelector('.lu-card');
        if (!card) return;
        const r = card.getBoundingClientRect();
        const inside = e.clientX >= r.left && e.clientX <= r.right && e.clientY >= r.top && e.clientY <= r.bottom;
        if (!inside) dlg.close();
      });
      dlg.querySelector('.lu-close')?.addEventListener('click', ()=>dlg.close());
      dlg.addEventListener('keydown', (e)=>{ if (e.key === 'Escape') dlg.close(); });
    }
  })();
  </script>

</body>
</html>
